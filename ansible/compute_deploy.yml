---

- hosts: all

  pre_tasks:
    - apt: update_cache=yes
      sudo: yes
    - apt: name=git state=present
      sudo: yes

  roles:
    - role: common_dependencies

    - role: postgresql
      postgresql_admin_user: "postgres"

    - role: openstack-nova
      nova_dir: /home/{{ global_os_user }}/nova
      nova_database_url: "{{ global_db }}://nova:{{ global_nova_password }}@localhost/nova"
      nova_neutron_url: "{{ global_controller_ip }}"
      nova_admin_auth_url: "http://{{ global_controller_ip }}:35357/v2.0"
      nova_type: "compute"
      neutron_auth_username: "{{ global_neutron_user }}"
      neutron_auth_password: "{{ global_neutron_password }}"
      controller_ip: "{{ global_controler_ip }}"
      my_ip: "{{ global_my_ip }}"
      nova_rabbitmq_ip: "{{ global_controller_ip }}"
      nova_rabbitmq_user: openstack
      nova_rabbitmq_password: tester

    - role: openstack-neutron
      neutron_dir: /home/{{ global_os_user }}/neutron
      neutron_database_url: "{{ global_db }}://neutron:{{ global_neutron_password }}@localhost/neutron"
      controller_ip: "{{ global_controller_ip }}"
      my_ip: "{{ global_my_ip }}"
      neutron_auth_username: "{{ global_neutron_user }}"
      neutron_auth_password: "{{ global_neutron_password }}"
      nova_auth_username: "{{ global_nova_user }}"
      nova_auth_password: "{{ global_nova_password }}"
      neutron_rabbitmq_ip: "{{ global_controller_ip }}"
      neutron_rabbitmq_user: "openstack"
      neutron_rabbitmq_password: "tester"
      neutron_type: "compute"
